# 01-setup.md:
### 1.
### project-root: 
```
mkdir youtube-downloader
cd youtube-downloader
```

### project-root, not src/
```
git init 
```
```
touch README.md 
```
```
git add README.md
git commit -m "Initial commit"
```
```
git checkout -b develop
```
```
touch .gitignore
```
### .gitignore
```
# Django #
*.log
*.pot
*.pyc
__pycache__
db.sqlite3
media

# Backup files #
*.bak

# If you are using PyCharm #
# User-specific stuff
.idea/**/workspace.xml
.idea/**/tasks.xml
.idea/**/usage.statistics.xml
.idea/**/dictionaries
.idea/**/shelf

# AWS User-specific
.idea/**/aws.xml

# Generated files
.idea/**/contentModel.xml

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# File-based project format
*.iws

# IntelliJ
out/

# JIRA plugin
atlassian-ide-plugin.xml

# Python #
*.py[cod]
*$py.class

# Distribution / packaging
.Python build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.coverage
.coverage.*
.cache
.pytest_cache/
nosetests.xml
coverage.xml
*.cover
.hypothesis/

# Jupyter Notebook
.ipynb_checkpoints

# pyenv
.python-version

# celery
celerybeat-schedule.*

# SageMath parsed files
*.sage.py

# Environments
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/
../env/

# mkdocs documentation
/site

# mypy
.mypy_cache/

# Sublime Text #
*.tmlanguage.cache
*.tmPreferences.cache
*.stTheme.cache
*.sublime-workspace
*.sublime-project

# sftp configuration file
sftp-config.json

# Package control specific files Package
Control.last-run
Control.ca-list
Control.ca-bundle
Control.system-ca-bundle
GitHub.sublime-settings

# Visual Studio Code #
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json
.history
```
```
git add .gitignore
git commit -m "Add .gitignore file"
```

### 2. 
```
git checkout -b feature/base-setup
```
### Create a virtual environment in project root not src/ (windows)
```
python -m venv venv
.\venv\Scripts\activate
```
### or
### Create a virtual environment in project root not src/ (linux)
```
python3 -m venv venv
source venv/bin/activate
```
```
mkdir src
cd src/
```
```
pip install django==5.2.4 pytube
django-admin startproject config .
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

### requirements.txt:
```
touch requirements.txt
pip freeze > requirements.txt
cat requirements.txt
```

# 3. 
### src/templates/
```
mkdir src/templates/
```
### src/config/settings.py
```
TEMPLATES = [
    {
        ...

        'DIRS': [BASE_DIR / 'templates'],

        ...

]
```
### src/static/
```
mkdir src/static/
```
```
STATIC_URL = 'static/'
STATICFILES_DIRS = [BASE_DIR / "static",] # development

MEDIA_ROOT = BASE_DIR / 'media'
MEDIA_URL = '/media/'
```
### src/config/urls.py
```
from django.contrib import admin
from django.urls import path, include

from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
  # path('', include('')),

] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

# 4.
### cd .. or terminal 2
```
git status
git add .
git commit -m "base-setup" 
```
```
git checkout develop
git merge feature/base-setup
```
### delete branch feature/base-setup
```
git branch -d feature/base-setup
```

# 02-app youtube.md:
### 1. git branch:
```
git checkout -b feature/youtube-app
```
### 2. startapp youtube:
```
python manage.py startapp youtube
```
### src/config/settings.py:
```
INSTALLED_APPS = [
    ...
    'youtube',
]
```
```
touch src/youtube/urls.py
```
### src/youtube/urls.py
```
from django.urls import path

urlpatterns = [
    path('', ),
]
```
### src/youtube/templates/
```
mkdir src/youtube/templates/
```
### cd .. or terminal 2:
```
git status
git add .
git commit -m "Add youtube app with basic setup" 
```

### 3. Models:
### src/youtube/models.py:
```
from django.db import models

class DownloadHistory(models.Model):
    url = models.URLField()
    title = models.CharField(max_length=255)
    quality = models.CharField(max_length=10)
    download_date = models.DateTimeField(auto_now_add=True)
    
    def __str__(self):
        return self.title
```
### install pillow:
```
pip install pillow
```
### requirements.txt:
```
pip freeze > requirements.txt
cat requirements.txt
```
### migrations:
```
python manage.py makemigrations
python manage.py migrate
```
### git commit:
```
git status
git add .
git commit -m "Add DownloadHistory model for tracking download metadata" 
```

### 4. views.py:
### src/youtube/views.py:
```
from django.shortcuts import render, redirect
from django.http import HttpResponse, FileResponse
from django.conf import settings
from pytube import YouTube
import os
from .models import DownloadHistory

def index(request):
    return render(request, 'youtube/index.html')

def download_video(request):
    if request.method == 'POST':
        video_url = request.POST.get('url')
        quality = request.POST.get('quality')
        
        try:
            yt = YouTube(video_url)
            
            # دریافت اطلاعات ویدیو
            video_title = yt.title
            streams = yt.streams.filter(progressive=True, file_extension='mp4')
            
            if quality == 'highest':
                stream = streams.get_highest_resolution()
            elif quality == 'lowest':
                stream = streams.get_lowest_resolution()
            else:
                stream = streams.filter(res=quality).first()
                if not stream:
                    stream = streams.get_highest_resolution()
            
            # مسیر ذخیره‌سازی
            download_path = os.path.join(settings.MEDIA_ROOT, 'youtube_downloads')
            os.makedirs(download_path, exist_ok=True)
            
            # دانلود ویدیو
            stream.download(output_path=download_path)
            file_path = os.path.join(download_path, stream.default_filename)
            
            # ذخیره تاریخچه دانلود
            DownloadHistory.objects.create(
                url=video_url,
                title=video_title,
                quality=stream.resolution
            )
            
            # ارسال فایل به کاربر
            response = FileResponse(open(file_path, 'rb'))
            response['Content-Disposition'] = f'attachment; filename="{stream.default_filename}"'
            
            # حذف فایل پس از ارسال (اختیاری)
            # import threading
            # threading.Timer(10.0, os.remove, [file_path]).start()
            
            return response
            
        except Exception as e:
            return render(request, 'youtube/download.html', {'error': str(e)})
    
    return redirect('index')

def download_page(request):
    return render(request, 'youtube/download.html')
```
### src/config/urls.py:
```
urlpatterns = [
  ...
  path('', include('youtube.urls')),

] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```
### src/youtube/urls.py:
```
from django.urls import path
from . import views

urlpatterns = [
    path('', views.index, name='index'),
    path('download/', views.download_page, name='download_page'),
    path('download/video/', views.download_video, name='download_video'),
]
```
```
git status
git add .
git commit -m "Implement YouTube video downloader with quality options and history tracking"
```

### 5. templates:
### src/templates/base.html:
```
touch src/templates/base.html
```
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}YouTube Downloader{% endblock %}</title>
</head>
<body>
    <div class="container">
        <div class="logo">YouTube Downloader</div>
        {% block content %}
        {% endblock %}
    </div>
</body>
</html>
```

### src/youtube/tempaltes/index.html:
```
mkdir src/youtube/tempaltes/
```
```
touch src/youtube/tempaltes/index.html
```
```
{% extends 'youtube/base.html' %}

{% block content %}
    <h1>Download YouTube Videos</h1>
    <form action="{% url 'download_page' %}" method="get">
        <input type="text" name="url" placeholder="Enter YouTube video URL" required>
        <br>
        <button type="submit">Continue</button>
    </form>
{% endblock %}
```

### src/youtube/tempaltes/download.html:
```
touch src/youtube/tempaltes/download.html
```
```
{% extends 'youtube/base.html' %}

{% block content %}
    <h1>Select Download Quality</h1>
    
    {% if error %}
        <div class="error">
            Error: {{ error }}
        </div>
        <a href="{% url 'index' %}" class="back-link">Back to Homepage</a>
    {% else %}
        <form action="{% url 'download_video' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="url" value="{{ request.GET.url }}">
            
            <label for="quality">Video Quality:</label><br>
            <select name="quality" id="quality">
                <option value="highest">Highest Quality</option>
                <option value="720p">720p (HD)</option>
                <option value="480p">480p</option>
                <option value="360p">360p</option>
                <option value="lowest">Lowest Quality</option>
            </select>
            <br><br>
            <button type="submit">Download Video</button>
        </form>
    {% endif %}
{% endblock %}
```

### src/static/css/main.css:
```
mkdir src/static/css
```
```
touch src/static/css/main.css
```
```
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    text-align: center;
    color: #333;
}
.container {
    max-width: 800px;
    margin: 50px auto;
    padding: 20px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
}
h1 {
    color: #ff0000;
    margin-bottom: 30px;
}
form {
    margin: 20px 0;
}
input[type="text"] {
    width: 70%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    margin-bottom: 15px;
}
select {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    margin: 10px 0;
}
button {
    background-color: #ff0000;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}
button:hover {
    background-color: #cc0000;
}
.error {
    color: red;
    margin: 20px 0;
    padding: 10px;
    background-color: #ffeeee;
    border-radius: 5px;
}
.back-link {
    display: inline-block;
    margin-top: 20px;
    color: #ff0000;
    text-decoration: none;
}
.back-link:hover {
    text-decoration: underline;
}
.logo {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #ff0000;
}
```
```
git status
git add .
git commit -m "Add frontend templates and CSS for YouTube downloader interface"
```

### 6. runserver
```
python manage.py runserver
```

